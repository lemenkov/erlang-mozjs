%% SPDX-FileCopyrightText: 2009-2010 Basho Technologies
%% SPDX-FileCopyrightText: 2020-2026 Peter Lemenkov <lemenkov@gmail.com>
%% SPDX-License-Identifier: Apache-2.0

{minimum_otp_vsn, "25"}.

{erl_opts, [
    warnings_as_errors,
    warn_export_vars,
    warn_unused_import
]}.

{cover_enabled, true}.

{plugins, [pc]}.

{provider_hooks, [
    {pre, [
        {compile, {pc, compile}},
        {clean, {pc, clean}}
    ]}
]}.

{project_plugins, [
    erlfmt
]}.

{erlfmt, [write]}.

{artifacts, ["priv/mozjs_nif.so"]}.

{pc_clang_db, true}.

{port_specs, [{"priv/mozjs_nif.so", ["c_src/*.cpp"]}]}.

{port_env, [
    {"DRV_CFLAGS", "$DRV_CFLAGS -std=c++17 -Wall -Wextra `pkg-config mozjs-140 --cflags 2>/dev/null || pkg-config mozjs-128 --cflags 2>/dev/null || pkg-config mozjs-115 --cflags`"},
    {"DRV_LDFLAGS", "$DRV_LDFLAGS `pkg-config mozjs-140 --libs 2>/dev/null || pkg-config mozjs-128 --libs 2>/dev/null || pkg-config mozjs-115 --libs`"}
]}.

{deps, [
    {jsx, "~> 3.1"}
]}.

{dialyzer, [
    {warnings, [
        error_handling,
        underspecs,
        unmatched_returns
    ]}
]}.

{xref_checks, [
    undefined_function_calls,
    undefined_functions,
    locals_not_used,
    deprecated_function_calls,
    deprecated_functions
]}.

{profiles, [
    {test, [
        {erl_opts, [nowarn_export_all]}
    ]}
]}.
